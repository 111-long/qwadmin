<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta charset="utf-8" />
		<title>分类列表-{$Think.CONFIG.title}</title>

		<meta name="keywords" content="{$Think.CONFIG.keywords}" />
		<meta name="description" content="{$Think.CONFIG.description}" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />

		<include file="Public/head" />
   </head>

	<body class="no-skin">
		<include file="Public/header" />
		<div class="main-container" id="main-container">
			<script type="text/javascript">
				try{ace.settings.check('main-container' , 'fixed')}catch(e){}
			</script>

			<include file="Public/sidebar" />
			<div class="main-content">
				<div class="main-content-inner">
					<!-- #section:basics/content.breadcrumbs -->
					<div class="breadcrumbs" id="breadcrumbs">
						<script type="text/javascript">
							try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
						</script>

						<ul class="breadcrumb">
							<li>
								<i class="ace-icon fa fa-home home-icon"></i>
								<a href="{$Think.CONFIG.URL}/Qwadmin/">首页</a>
							</li>

							<li>
								<a href="#">网站内容</a>
							</li>
							<li class="active">分类列表</li>
						</ul><!-- /.breadcrumb -->
					</div>

					<!-- /section:basics/content.breadcrumbs -->
					<div class="page-content">
						<include file="Public/set" />

						<!-- /section:settings.box -->
						<div class="row">
							<div class="col-xs-12">
								<!-- PAGE CONTENT BEGINS -->
								<div class="sort col-xs-10">
									{$category}
								</div>
								<!-- PAGE CONTENT ENDS -->
							</div><!-- /.col -->
						</div><!-- /.row -->
					</div><!-- /.page-content -->
				</div>
			</div><!-- /.main-content -->
			<include file="Public/footer" />
			
		</div><!-- /.main-container -->

		<include file="Public/footerjs" />
		<!-- inline scripts related to this page -->
		<script type="text/javascript">
			$(function(){
				$(".idpid").on('mouseover',function(){
					$(this).addClass('bg-success');
				});
				$(".idpid").on('mouseout',function(){
					$(this).removeClass('bg-success');
				});

				$(".sort").on('click',".fa-folder",function(){
					$(this).removeClass('fa-folder').addClass("fa-folder-open");
					var obj = $(this).parent();
					var id = obj.attr('val');
					var pid = obj.attr('pid');
					openchild(pid,id);
				 })

				$(".sort").on('click',".fa-folder-open",function(){
					$(this).removeClass('fa-folder-open').addClass("fa-folder");
					var obj = $(this).parent();
					var id = obj.attr('val');
					var pid = obj.attr('pid');
					closechild(pid,id);
				 })
				
				function closechild(pid,id){
					var obj = $('.pid'+id);//获取所有子元素
					obj.addClass('hidden');//子元素关闭
					obj.find('.fa-folder-open').removeClass('fa-folder-open').addClass("fa-folder");
					obj.each(function(){
						var child_pid = $(this).attr('pid');
						var child_id = $(this).attr('val');
						closechild(child_pid,child_id);
					 });
				}
				
				function openchild(pid,id){
					var obj = $('.pid'+id);//获取所有子元素
					obj.removeClass('hidden');//子元素关闭
					obj.each(function(){
						var child_pid = $(this).attr('pid');
						var child_id = $(this).attr('val');
						closechild(child_pid,child_id);
					 });
				}
				
				$(".sort").on('click',".fa-trash-o",function(){
					var obj = $(this);
					var id = obj.attr('id');
					bootbox.confirm({
						title: "系统提示",
						message: "是否要删除该分类？", 
						callback:function(result){
							if(result){
								$.get("{:U('del')}?id="+id, function(result){
									if(result==2){
										bootbox.alert({  
											buttons: {  
											   ok: {  
													label: '确定',  
													className: 'btn-myStyle'  
												}  
											},  
											message: '该类下拥有子类，无法删除。', 
											title: "提示信息",  
										});  
										return;
									}else if(result==1){
										bootbox.confirm({  
											buttons: {  
												confirm: {  
													label: '是',  
													className: 'btn-myStyle'  
												},  
												cancel: {  
													label: '否',  
													className: 'btn-default'  
												}
											},  
											message: '恭喜，分类删除成功！是否刷新？',  
											callback: function(result) {  
												if(result) {  
													window.location.reload(true);
												} 
											},  
											title: "提示信息",  
										});
										return;
									}else{
										bootbox.dialog({
											message: "抱歉，系统错误，请稍后再试。", 
											buttons: {
												"success" : {
													"label" : "确定",
													"className" : "btn-danger"
												}
											}
										});
										return;
									}
								 });
							}else{
								return true;
							}
						},
						buttons: {
							"cancel" : {"label" : "取消"},
							"confirm" : {
									"label" : "确定",
									"className" : "btn-danger"
								}
						}
					});
				})
			})

			
		</script>

	</body>
</html>
